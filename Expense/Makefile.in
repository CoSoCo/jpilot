top_srcdir = @top_srcdir@
top_builddir = @top_srcdir@

# Install variables
prefix=@prefix@

#Pilot flags (include dir), and Libraries
PILOT_FLAGS=@PILOT_FLAGS@
PILOT_LIBS=@PILOT_LIBS@

#set CC to your compiler
CC = @CC@
INSTALL = @INSTALL@
LIBTOOL = @LIBTOOL@

# CC options
CCDEFINES = @DEFS@
CFLAGS = @cflags@
OPTIONS = @ccoptions@ $(CFLAGS)

# GTK+ flags
GTKFLAGS = @GTK_CFLAGS@
# GTK+ libs
GTKLIBS = @GTK_LIBS@

# Targets
all: libplugin.h expense.o libexpense.so

libexpense.so: expense.o
	$(LIBTOOL) --mode=link \
	$(CC) $(OPTIONS) -o libexpense.la \
	expense.lo \
	-rpath $(prefix)/lib/jpilot/plugins \
	-version-info 1:1 \
	-avoid-version

expense.o: expense.c libplugin.h
	$(LIBTOOL) --mode=compile \
	$(CC) $(OPTIONS) $(GTKFLAGS) $(PILOT_FLAGS) -c expense.c

libplugin.h: ../libplugin.h
	rm -f libplugin.h; ln -s ../libplugin.h libplugin.h; \

clean: 
	rm -f *.o *~ config.cache .libs/* *.so *.so.? *.so.?.? *.lo *.la
	rm -f .libs/*

distclean: clean
	rm -f config.status config.log *.so Makefile

#
# This is a global install.  You can also install per user in
# ~/.jpilot/plugins
#
install:
	$(INSTALL) -d -m 755 $(prefix)/lib/jpilot; \
	$(INSTALL) -d -m 755 $(prefix)/lib/jpilot/plugins; \
	$(LIBTOOL) --mode=install -c $(INSTALL) \
	libexpense.la $(prefix)/lib/jpilot/plugins

local_install:
	$(INSTALL) -d -m 755 $(HOME)/.jpilot; \
	$(INSTALL) -d -m 755 $(HOME)/.jpilot/plugins; \
	$(LIBTOOL) --mode=install -c $(INSTALL) \
	libexpense.la $(HOME)/.jpilot/plugins

uninstall:
	rm -f $(prefix)/lib/jpilot/plugins/libexpense.so*
